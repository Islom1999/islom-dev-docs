import{_ as n,o as s,c as a,d as e}from"./app-a9a991a6.js";const t={},o=e(`<h1 id="ðŸ“”-middleware" tabindex="-1"><a class="header-anchor" href="#ðŸ“”-middleware" aria-hidden="true">#</a> ðŸ“” Middleware</h1><h1 id="_1-tushunchalar" tabindex="-1"><a class="header-anchor" href="#_1-tushunchalar" aria-hidden="true">#</a> 1-Tushunchalar</h1><p>NestJS&#39;da Middleware, uchun bir turi bo&#39;lgan ad-hoc modullardir, u ularni boshqarishga yordam beradigan bir qancha yo&#39;nalishlari bor. Ular sizning ilovalaringizda kerakli bo&#39;lgan aralash joylarda o&#39;tishni boshqarishga yordam beradi.</p><p>Middleware&#39;ni, route handler&#39;lar ishga tushishdan oldin bajariladigan funksiyalar sifatida o&#39;ylang. Ular so&#39;rov va javob ob&#39;ektlariga kirishga ruxsat beradi, shuningdek, so&#39;rov jarayonini keyingi Middleware funksiyasiga o&#39;tkazish uchun <code>next()</code> funksiyasini chaqiradi.</p><p>Quyidagi kod bir misol bo&#39;la oladi:</p><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> NestMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@nestjs/common&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Request<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> NextFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;express&#39;</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">LoggerMiddleware</span> <span class="token keyword">implements</span> <span class="token class-name">NestMiddleware</span> <span class="token punctuation">{</span>
  <span class="token function">use</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">,</span> next<span class="token operator">:</span> NextFunction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Request...&#39;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>method<span class="token punctuation">,</span> req<span class="token punctuation">.</span>originalUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Bu <code>LoggerMiddleware</code> har bir so&#39;rovni konsolga chiqaradi. Endi bu Middleware&#39;ni ilovamizga ulashishimiz kerak. Buni ikkita usul bilan qilishimiz mumkin: funksional yoki modul usul.</p><h3 id="funktsional-usul" tabindex="-1"><a class="header-anchor" href="#funktsional-usul" aria-hidden="true">#</a> Funktsional usul:</h3><p>Funksional usulda, Middleware&#39;ni ilovaning bosh module&#39;siga qo&#39;shishimiz kerak. Bu <code>app.module.ts</code> faylida amalga oshiriladi:</p><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module<span class="token punctuation">,</span> NestModule<span class="token punctuation">,</span> MiddlewareConsumer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@nestjs/common&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> LoggerMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./logger.middleware&#39;</span><span class="token punctuation">;</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token keyword">implements</span> <span class="token class-name">NestModule</span> <span class="token punctuation">{</span>
  <span class="token function">configure</span><span class="token punctuation">(</span>consumer<span class="token operator">:</span> MiddlewareConsumer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">consumer</span>
      <span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>LoggerMiddleware<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forRoutes</span><span class="token punctuation">(</span><span class="token string">&#39;*&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Bu yerda <code>forRoutes(&#39;*&#39;)</code> barcha yo&#39;nalishlar uchun <code>LoggerMiddleware</code>&#39;ni qo&#39;llashni anglatadi.</p><h3 id="modul-usul" tabindex="-1"><a class="header-anchor" href="#modul-usul" aria-hidden="true">#</a> Modul usul:</h3><p>Modul usulda, <code>configure()</code> metodini yaratish orqali modul ichida Middleware&#39;ni ulashimiz mumkin:</p><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module<span class="token punctuation">,</span> NestModule<span class="token punctuation">,</span> MiddlewareConsumer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@nestjs/common&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> LoggerMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./logger.middleware&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CatsModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./cats/cats.module&#39;</span><span class="token punctuation">;</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>CatsModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token keyword">implements</span> <span class="token class-name">NestModule</span> <span class="token punctuation">{</span>
  <span class="token function">configure</span><span class="token punctuation">(</span>consumer<span class="token operator">:</span> MiddlewareConsumer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">consumer</span>
      <span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>LoggerMiddleware<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forRoutes</span><span class="token punctuation">(</span><span class="token string">&#39;cats&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Bu yerda <code>forRoutes(&#39;cats&#39;)</code> faqat <code>/cats</code> yo&#39;nalishi uchun <code>LoggerMiddleware</code>&#39;ni qo&#39;llashni anglatadi. Bu yo&#39;nalishlar to&#39;plamiga o&#39;tishdan oldin <code>LoggerMiddleware</code> bajariladi.</p><p>Bu usullar sizning ilovangizda Middleware&#39;ni qanday qo&#39;llashni istaganingizga qarab turadi. Ikkalasi ham o&#39;ziga xos qulayliklariga ega.</p><h1 id="hayotiy-misol" tabindex="-1"><a class="header-anchor" href="#hayotiy-misol" aria-hidden="true">#</a> Hayotiy misol</h1><p>Tabiiyki, aytaylik bizning ilovamizda foydalanuvchilarning autentifikatsiyasini tekshirish uchun middleware yaratishga harakat qilib ko&#39;ramiz. Ushbu misolimizda, biz express.js-dan <code>Request</code>, <code>Response</code>, <code>NextFunction</code> ob&#39;ektlarini import qilamiz va <code>CheckAuthMiddleware</code> deb nomlangan middleware yaratamiz.</p><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> NestMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@nestjs/common&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Request<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> NextFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;express&#39;</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CheckAuthMiddleware</span> <span class="token keyword">implements</span> <span class="token class-name">NestMiddleware</span> <span class="token punctuation">{</span>
  <span class="token function">use</span><span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">,</span> next<span class="token operator">:</span> NextFunction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token operator">:</span> <span class="token string">&#39;No credentials sent!&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// real-life scenario&#39;da siz shu yerda token&#39;ni tekshirib ko&#39;rasiz</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Ushbu middleware har bir so&#39;rovni tekshiradi va agar <code>authorization</code> sarlavhasi mavjud bo&#39;lmasa, 403 (forbidden) status kodini qaytaradi.</p><p>Endi, bu middleware&#39;ni bir modulga joylashtiraylik. Misol uchun, <code>UsersModule</code> deb nomlangan bir modulga joylashtirishni ko&#39;ramiz:</p><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module<span class="token punctuation">,</span> NestModule<span class="token punctuation">,</span> MiddlewareConsumer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@nestjs/common&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CheckAuthMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./check-auth.middleware&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UsersController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./users.controller&#39;</span><span class="token punctuation">;</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>UsersController<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UsersModule</span> <span class="token keyword">implements</span> <span class="token class-name">NestModule</span> <span class="token punctuation">{</span>
  <span class="token function">configure</span><span class="token punctuation">(</span>consumer<span class="token operator">:</span> MiddlewareConsumer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">consumer</span>
      <span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>CheckAuthMiddleware<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forRoutes</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Bu kod <code>CheckAuthMiddleware</code>&#39;ni <code>UsersModule</code>&#39;ning barcha yo&#39;nalishlariga qo&#39;shadi. Bu shuni anglatadi ki, <code>users</code> yo&#39;nalishida har qanday so&#39;rov <code>CheckAuthMiddleware</code>dan o&#39;tadi, bu esa so&#39;rovda <code>authorization</code> sarlavhasi mavjudligini tekshiradi.</p><p>Bu o&#39;rnakda, real-life scenario&#39;da siz <code>authorization</code> sarlavhasidagi token&#39;ni tekshirib, foydalanuvchining tizimga kirish huquqiga ega bo&#39;lganligini tekshirishingiz kerak bo&#39;lar edi. Biroq, bu o&#39;rnak sizga NestJS middleware&#39;ning qanday ishlashini tushuntirish uchun mo&#39;ljallangan.</p>`,24),i=[o];function p(c,l){return s(),a("div",null,i)}const d=n(t,[["render",p],["__file","middleware.html.vue"]]);export{d as default};
